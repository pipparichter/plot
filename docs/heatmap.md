# The HeatmapPlot class

## Initialization

Heatmaps can be created using the `HeatmapPlot` class. The Heatmap class currently supports two different modes, 
which have slightly different initializations. The mode is determined by the `toplot` argument. The `toplot` string is of the
 format `{yaxis}_{variable}`; for example `s_rp` plots a heatmap or a grid of heatmaps with samples (`s`) on the 
y-axis, where the entire Heatmap displays data for a specified reference subpopulation (`rp`).
 The expression level in each HeatmapPlot type is calculated by taking the L1 distance metric between an 
expression distribution for the sample and one for the control (see **The BarPlot class** for information on how \these distributions are calculated.).

### `s_ct`

This HeatmapPlot mode plots genes on the x-axis and samples on the y-axis. The cells of the heatmap correspond to the expression
level of a gene in a particular sample; each plot represents data for a single celltype.

* `pop` **dict** The PopAlign object.
* `samples` **str, list, None** The sample or list of samples for which plots will be created. If `None`, all samples
    will be used (see `plot._init_samples()`). 
* `celltype` **str** The celltype for which the plot will be created, either `Myeloid`, `B-cell`, or `T-cell`. 
* `genes` **list, None** The genes for which the plot(s) will be created. The inputted gene name or list of 
names must be valid, i.e. in the list `pop['filtered_genes']`. `None` by default; in this case, 
[unsupervised gene selection](./diffexp.md) will be applied.
* `diffexp_data` **dict** A structure containing information on differentially-expressed genes. This dictionary
must be generated by the `plot.get_diffexp_data()` function. More information on this function can be found
[here](./diffexp.md).
* `cluster` **bool** Whether or not clustering will be carried out on the data. `True` by default.
* `**kwargs` Optional clustering settings. See the **Clustering** subsection for more information. 

### `s_rp`

This HeatmapPlot plots genes on the x-axis and samples on the y-axis. The cells of the heatmap correspond to the expression
level of the intersecting gene and sample. Each plot represents data from a particular group of subpopulations, which
align to the inputted reference population. 

* `pop` **dict** The PopAlign object.
* `samples` **str, list, None** The sample or list of samples for which plots will be created. If `None`, all samples
    will be used (see `plot._init_samples()`). 
* `refpop` **int** The celltype for which the plot will be created, either `Myeloid`, `B-cell`, or `T-cell`. 
* `genes` **list, None** The genes for which the plot(s) will be created. The inputted gene name or list of 
names must be valid, i.e. in the list `pop['filtered_genes']`. `None` by default; in this case, 
[unsupervised gene selection](./diffexp.md) will be applied.
* `diffexp_data` **dict** A structure containing information on differentially-expressed genes. This dictionary
must be generated by the `plot.get_diffexp_data()` function. More information on this function can be found
[here](./diffexp.md).
* `cluster` **bool** Whether or not clustering will be carried out on the data. `True` by default.
* `**kwargs` Optional clustering settings. See the **Clustering** subsection for more information. 

### Clustering

Specific clustering settings can be specified using the following keyword arguments:

* `cluster_plot_dendrograms` **bool**
* `cluster_axis` **str** The axis along which to cluster the data. One of `'x'`, `'y'`, `'both'`. This setting is 
`'both'` by default.
* `cluster_metric` **str** The distance metric to use to calculate the distance between the vectors being clustered.
`'euclidean'` by default; more options are specified in the 
[SciKit Learn documentation](https://scikit-learn.org/stable/modules/generated/sklearn.cluster.AgglomerativeClustering.html).
* `cluster_linkage` **str** The method used to determine the "closeness" of a point to a cluster. `'complete'` by default;
more options are specified in the 
[SciKit Learn documentation](https://scikit-learn.org/stable/modules/generated/sklearn.cluster.AgglomerativeClustering.html).

`plotpop` uses an agglomerative hierarchical clustering approach. First, a pairwise distance matrix is
computed using the collected L1 expression; the distance metric used is that specified by `cluster_metric`. 
Then, the matrix is passed into an `sklearn.cluster.AgglomerativeClustering` object, which produces a clustering model.
The model then recursively sorts the data along the selected `cluster_axis` into `cluster_nclusters` groups. It does so by 
treating each datapoint as an individual cluster, and combining the "nearest" clusters according to the `cluster_linkage` 
kinkage method.


## Usage


